<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½ç­¾æƒ©ç½šæ¸¸æˆ</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            margin: 0;
            color: #333;
        }

        /* æ¸¸æˆä¸»å®¹å™¨ */
        .game-container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 90%;
            max-width: 500px;
            margin-bottom: 25px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        /* åˆ†æ•°æ˜¾ç¤º */
        .score-board {
            font-size: 24px;
            margin-bottom: 25px;
        }

        #score {
            font-size: 3em;
            font-weight: bold;
            color: #3498db;
            display: block;
            margin-top: 10px;
        }
        
        /* ç»“æœæ˜¾ç¤ºåŒºåŸŸ */
        .result-area {
            min-height: 80px;
            padding: 20px;
            margin-top: 20px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.1s ease; /* åŠ¨ç”»æ—¶åˆ‡æ¢æ›´å¿« */
            border: 2px solid #ccc;
        }
        
        /* æ–°å¢ï¼šæŠ½ç­¾åŠ¨ç”»è¿›è¡Œä¸­çš„æ ·å¼ */
        .result-area.is-drawing {
            border-style: dashed;
            border-color: #3498db;
        }

        /* å¡ç‰‡ç±»å‹æ ·å¼ */
        .card-plus { background-color: #e8f5e9; color: #2e7d32; border-color: #a5d6a7; }
        .card-minus { background-color: #ffebee; color: #c62828; border-color: #ef9a9a; }
        .card-event { background-color: #e3f2fd; color: #1565c0; border-color: #90caf9; }
        .card-win { background-color: #fffde7; color: #f57f17; border-color: #fdd835; }

        /* æŒ‰é’®æ ·å¼ */
        .button-container { margin-top: 30px; }
        
        button {
            padding: 15px 30px;
            font-size: 18px;
            color: white;
            background-color: #3498db;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            margin: 5px;
        }

        button:hover:not(:disabled) { background-color: #2980b9; }
        button:active:not(:disabled) { transform: scale(0.98); }
        button:disabled { background-color: #bdc3c7; cursor: not-allowed; }
        #reset-button { background-color: #e74c3c; display: none; }
        #reset-button:hover { background-color: #c0392b; }
        
        /* å†å²è®°å½•æ ·å¼ */
        .history-container {
            background-color: #ffffff;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
        }
        .history-container h2 { text-align: center; color: #2c3e50; margin-top: 0; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        #history-list { list-style-type: none; padding: 0; margin: 0; max-height: 250px; overflow-y: auto; }
        #history-list li { padding: 12px; margin-bottom: 8px; border-radius: 8px; border: 1px solid #ddd; font-size: 0.9em; }
        #history-list li.history-placeholder { text-align: center; color: #999; background: #fafafa; }
        .history-plus { background-color: #e8f5e9; border-color: #c8e6c9; }
        .history-minus { background-color: #ffebee; border-color: #ffcdd2; }
        .history-event { background-color: #e3f2fd; border-color: #bbdefb; }
    </style>
</head>
<body>

    <div class="game-container">
        <h1>æŠ½ç­¾æƒ©ç½šæ¸¸æˆ</h1>
        <div class="score-board">
            å½“å‰åˆ†æ•°:
            <span id="score">0</span>
        </div>

        <div id="result-area" class="result-area">
            ç‚¹å‡»â€œæŠ½ç­¾â€æŒ‰é’®å¼€å§‹æ¸¸æˆï¼åˆ†æ•°è¾¾åˆ°100ä¸ºæˆåŠŸ
        </div>
        
        <div class="button-container">
            <button id="draw-button">æŠ½ ç­¾</button>
            <button id="reset-button">é‡æ–°å¼€å§‹</button>
        </div>
        <p>å„è¿å€¼:<span id="unluckylable">15</span>(å„è¿å€¼ä¸º0æ—¶å°†ä¸å‡åˆ†)</p>
    </div>

    <div class="history-container">
        <h2>æŠ½ç­¾å†å²</h2>
        <ul id="history-list"></ul>
    </div>

    <!-- å¼•å…¥ confetti.js åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    
    <script>
        // --- æ¸¸æˆé…ç½® ---
const targetScore = 100;
const animationDuration = 6000; // åŠ¨ç”»æ€»æ—¶é•¿ï¼Œå¯ä»¥é€‚å½“åŠ é•¿ä¸€ç‚¹
const initialDelay = 100;        // åŠ¨ç”»åˆå§‹å¸§çš„å»¶è¿Ÿï¼ˆmsï¼‰ï¼Œè¶Šå°è¶Šå¿«
const finalDelay = 1200;         // åŠ¨ç”»æœ€ç»ˆå¸§çš„å»¶è¿Ÿï¼ˆmsï¼‰ï¼Œè¶Šå¤§è¶Šæ…¢

const cards = [
            { type: 'plus', value: 7, text: 'è—¤æ¡20ä¸‹,åˆ†æ•° +7' },
            { type: 'plus', value: 8, text: 'æˆ’å°º30ä¸‹,åˆ†æ•° +8' },
            { type: 'plus', value: 10, text: 'æœ¨æ¿20ä¸‹,åˆ†æ•° +10' },
            { type: 'plus', value: 8, text: 'æˆ’å°º30ä¸‹,åˆ†æ•°+8' },
            { type: 'plus', value: 8, text: 'è—¤æ¡30ä¸‹,åˆ†æ•°+8 ' },
            { type: 'plus', value: 8, text: 'å°çº¢50ä¸‹,åˆ†æ•°+8' },
            { type: 'plus', value: 9, text: 'æ— äº‹å‘ç”Ÿ,åˆ†æ•°+9' },
            { type: 'plus', value: 9, text: 'æˆ’å°º50ä¸‹,åˆ†æ•°+9' },
            { type: 'plus', value: 12, text: 'å°çº¢30ä¸‹,åˆ†æ•°+12' },
            { type: 'plus', value: 7, text: 'æœ¨æ¿30ä¸‹,åˆ†æ•°+7' },
            { type: 'plus', value: 6, text: 'è—¤æ¡20ä¸‹,åˆ†æ•°+6' },
            { type: 'plus', value: 8, text: 'æ— äº‹å‘ç”Ÿ,åˆ†æ•°+8' },
            { type: 'plus', value: 13, text: 'æ— äº‹å‘ç”Ÿ,åˆ†æ•°+13' },
            { type: 'plus', value: 7, text: 'æ— äº‹å‘ç”Ÿ,åˆ†æ•°+7' },
            { type: 'plus', value: 6, text: 'æ— äº‹å‘ç”Ÿ,åˆ†æ•°+6' },
            { type: 'plus', value: 8, text: 'å·´æŒ40ä¸‹,åˆ†æ•°+8' },
            { type: 'plus', value: 6, text: 'å·´æŒ20ä¸‹,åˆ†æ•°+6' },
            
            // å‡åˆ†å¡
            { type: 'minus', value: 2, text: 'æ— äº‹å‘ç”Ÿ,åˆ†æ•°-2' },
            { type: 'minus', value: 3, text: 'å°çº¢30ä¸‹,åˆ†æ•°-3' },
            { type: 'minus', value: 4, text: 'æ— äº‹å‘ç”Ÿ,åˆ†æ•°-4' },
            { type: 'minus', value: 3, text: 'æˆ’å°º20ä¸‹,åˆ†æ•°-3' },
            
            // äº‹ä»¶å¡
            { type: 'event', text: 'å°çº¢30ä¸‹' },
            { type: 'event', text: 'æˆ’å°º30ä¸‹' },
            { type: 'event', text: 'è—¤æ¡20ä¸‹' },
            { type: 'event', text: 'æœ¨æ¿30ä¸‹' },
            { type: 'event', text: 'å°çº¢30ä¸‹' },
            { type: 'clear', text: 'è¿æ°”å¤ªå·®,åˆ†æ•°æ¸…0' },
            { type: 'divided', text: 'è¿æ°”æœ‰ç‚¹å·®,ä¸¢å¤±ä¸€åŠåˆ†æ•°' },

];

// --- DOM å…ƒç´ è·å– ---
const scoreEl = document.getElementById('score');
const resultAreaEl = document.getElementById('result-area');
const drawButton = document.getElementById('draw-button');
const resetButton = document.getElementById('reset-button');
const historyListEl = document.getElementById('history-list');

// --- æ¸¸æˆçŠ¶æ€å˜é‡ ---
let currentScore = 0;
let isAnimating = false;
let historyLog = [];
let unlucky = 15;

// --- æ¸¸æˆæ ¸å¿ƒå‡½æ•° ---

function initGame() {
    currentScore = 0;
    isAnimating = false;
    historyLog = [];
    updateScoreDisplay();
    updateHistoryDisplay();
    resultAreaEl.textContent = 'ç‚¹å‡»â€œæŠ½ç­¾â€æŒ‰é’®å¼€å§‹æ¸¸æˆï¼åˆ†æ•°è¾¾åˆ°100ä¸ºæˆåŠŸ';
    resultAreaEl.className = 'result-area';
    drawButton.disabled = false;
    drawButton.textContent = 'æŠ½ ç­¾';
    resetButton.style.display = 'none';
}

function updateScoreDisplay() {
    scoreEl.textContent = currentScore;
}

function updateHistoryDisplay() {
    historyListEl.innerHTML = '';
    if (historyLog.length === 0) {
        historyListEl.innerHTML = '<li class="history-placeholder">æš‚æ— å†å²è®°å½•</li>';
        return;
    }
    historyLog.forEach(entry => {
        const li = document.createElement('li');
        li.classList.add(`history-${entry.type}`);
        li.innerHTML = `${entry.text} <strong>(å½“æ—¶åˆ†æ•°: ${entry.scoreAfter})</strong>`;
        historyListEl.appendChild(li);
    });
}

function drawCard() {
    if (isAnimating || currentScore >= targetScore) return;

    isAnimating = true;
    drawButton.disabled = true;
    drawButton.textContent = 'æŠ½ç­¾ä¸­...';
    resultAreaEl.classList.add('is-drawing');

    const finalCard = cards[Math.floor(Math.random() * cards.length)];
    
    // è°ƒç”¨æ–°çš„å˜é€ŸåŠ¨ç”»å‡½æ•°
    runDeceleratingAnimation(finalCard);
}

// *** æ–°å¢ï¼šå˜é€ŸåŠ¨ç”»å‡½æ•° ***
function runDeceleratingAnimation(finalCard) {
    const startTime = Date.now();

    function nextFrame() {
        const elapsedTime = Date.now() - startTime;

        // 1. å¦‚æœæ—¶é—´åˆ°ï¼Œåˆ™ç»“æŸåŠ¨ç”»
        if (elapsedTime >= animationDuration) {
            finalizeDraw(finalCard);
            return;
        }

        // 2. æ˜¾ç¤ºä¸€ä¸ªéšæœºçš„å¡ç‰‡ä½œä¸ºåŠ¨ç”»å¸§
        const randomCard = cards[Math.floor(Math.random() * cards.length)];
        resultAreaEl.textContent = randomCard.text;
        resultAreaEl.className = 'result-area is-drawing';
        resultAreaEl.classList.add(`card-${randomCard.type}`);

        // 3. è®¡ç®—ä¸‹ä¸€æ¬¡çš„å»¶è¿Ÿæ—¶é—´
        const progress = elapsedTime / animationDuration; // åŠ¨ç”»è¿›åº¦ (0 åˆ° 1)
        // ä½¿ç”¨çº¿æ€§æ’å€¼è®¡ç®—å½“å‰å»¶è¿Ÿï¼Œå®ç°ä»å¿«åˆ°æ…¢çš„æ•ˆæœ
        const currentDelay = initialDelay + (progress * (finalDelay - initialDelay));
        
        // 4. è®¾ç½®ä¸‹ä¸€ä¸ªåŠ¨ç”»å¸§
        setTimeout(nextFrame, currentDelay);
    }

    // å¯åŠ¨ç¬¬ä¸€å¸§
    nextFrame();
}

// *** æ–°å¢ï¼šå°†åŠ¨ç”»ç»“æŸåçš„é€»è¾‘å°è£…æˆä¸€ä¸ªå‡½æ•° ***
function finalizeDraw(card) {
    // è®¡ç®—åˆ†æ•°
    switch(card.type) {
        case 'plus':
            currentScore += card.value;
            unlucky = unlucky + 0.5;
            break;
        case 'minus':
            if (unlucky >=1)currentScore -= card.value;
            unlucky=unlucky- 1;
            if (unlucky <=0)unlucky=0;
            break;
        case 'clear':
            if (unlucky >= 5) currentScore = 0;
            unlucky=unlucky- 10;
            if (unlucky <=0)unlucky=0;
            break;
        case 'divided':
            if (unlucky >=5)currentScore = currentScore/2;
            unlucky=unlucky- 5;
            if (unlucky <=0)unlucky=0;
            break;
    }
    
    // æ›´æ–°æ˜¾ç¤º
    updateScoreDisplay();
    resultAreaEl.textContent = card.text;
    resultAreaEl.className = 'result-area';
    resultAreaEl.classList.add(`card-${card.type}`);
    document.getElementById("unluckylable").textContent = unlucky;

    // æ·»åŠ åˆ°å†å²è®°å½•
    const historyEntry = { text: card.text, type: card.type, scoreAfter: currentScore };
    historyLog.unshift(historyEntry);
    updateHistoryDisplay();
    
    // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
    if (checkWinCondition()) {
        triggerConfetti();
    } else {
        // æ¸¸æˆæœªç»“æŸï¼Œæ¢å¤çŠ¶æ€
        isAnimating = false;
        drawButton.disabled = false;
        drawButton.textContent = 'æŠ½ ç­¾';
    }
}

function checkWinCondition() {
    if (currentScore >= targetScore) {
        drawButton.disabled = true;
        drawButton.textContent = 'æ¸¸æˆç»“æŸ';
        resetButton.style.display = 'inline-block';
        resultAreaEl.innerHTML = `ğŸ‰ æ­å–œï¼ä½ è¾¾åˆ°äº† ${currentScore} åˆ†ï¼Œèµ¢å¾—æ¸¸æˆï¼ ğŸ‰`;
        resultAreaEl.className = 'result-area card-win';
        return true;
    }
    return false;
}

function triggerConfetti() {
    if (typeof confetti === 'function') {
        confetti({
            particleCount: 150,
            spread: 90,
            origin: { y: 0.6 }
        });
    }
}

// --- äº‹ä»¶ç›‘å¬ ---
drawButton.addEventListener('click', drawCard);
resetButton.addEventListener('click', initGame);

// --- åˆå§‹åŠ è½½ ---
initGame();
    </script>
</body>
</html>